#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "../lib/factorix"
require "zip"

# Suppress warnings about invalid dates in ZIP files
Zip.warn_invalid_date = false

begin
  Dry::CLI.new(Factorix::CLI).call
  exit 0
rescue Factorix::Error => e
  logger = Factorix::Application[:logger]
  logger.warn(e.message)
  logger.debug(e)
  warn "Error: #{e.message}"
  exit 1
rescue => e
  logger = Factorix::Application[:logger]
  logger.error(e)
  warn "Unexpected error: #{e.message}"
  warn e.backtrace.join("\n")
  exit 2
end
